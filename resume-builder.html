<!-- åœ¨çº¿ç®€å†åˆ¶ä½œå·¥å…·ï¼ˆå•æ–‡ä»¶HTMLå®ç°ï¼Œæ— éœ€æ„å»ºæ­¥éª¤ï¼‰-->
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åœ¨çº¿ç®€å†åˆ¶ä½œå·¥å…·</title>
  <link rel="icon" type="image/x-icon" href="./favicon.ico">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
      background: #f5f5f7;
      overflow-x: hidden;
    }
    .container {
      display: flex;
      height: 100vh;
      flex-direction: column;
    }
    
    /* å¤´éƒ¨å·¥å…·æ  */
    .header {
      background: white;
      padding: 12px 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 12px;
      z-index: 100;
    }
    .header h1 {
      font-size: 20px;
      color: #1d1d1f;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .toolbar {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    .theme-selector {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .theme-selector label {
      font-size: 14px;
      color: #666;
    }
    .theme-selector select {
      padding: 6px 12px;
      border: 1px solid #d2d2d7;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      background: white;
    }
    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .btn-primary {
      background: #0071e3;
      color: white;
    }
    .btn-primary:hover {
      background: #0077ed;
    }
    .btn-secondary {
      background: #f5f5f7;
      color: #1d1d1f;
    }
    .btn-secondary:hover {
      background: #e8e8ed;
    }
    .btn-danger {
      background: #ff3b30;
      color: white;
    }
    .btn-danger:hover {
      background: #ff453a;
    }
    .btn-group {
      display: flex;
      gap: 8px;
    }
    
    /* ä¸»å†…å®¹åŒº */
    .main-content {
      display: flex;
      flex: 1;
      overflow: hidden;
      gap: 1px;
      background: #d2d2d7;
    }
    .editor-panel, .preview-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background: white;
    }
    .panel-header {
      padding: 16px 20px;
      font-size: 16px;
      font-weight: 600;
      border-bottom: 1px solid #e5e5ea;
      background: #fafafa;
      color: #1d1d1f;
    }
    
    /* ç¼–è¾‘å™¨åŒºåŸŸ */
    .editor-content {
      flex: 1;
      padding: 24px;
      overflow-y: auto;
    }
    .form-section {
      background: white;
      border: 1px solid #e5e5ea;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .form-section h3 {
      font-size: 18px;
      color: #1d1d1f;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .form-group {
      margin-bottom: 16px;
    }
    .form-group label {
      display: block;
      font-size: 14px;
      color: #666;
      margin-bottom: 6px;
      font-weight: 500;
    }
    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #d2d2d7;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
      transition: border-color 0.2s;
    }
    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #0071e3;
    }
    .form-group textarea {
      min-height: 80px;
      resize: vertical;
    }
    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
    }
    
    /* å¤´åƒä¸Šä¼  */
    .avatar-upload {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 16px;
    }
    .avatar-preview {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 2px solid #e5e5ea;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background: #f5f5f7;
      position: relative;
    }
    .avatar-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .avatar-placeholder {
      font-size: 32px;
      color: #999;
    }
    .avatar-upload input[type="file"] {
      display: none;
    }
    .avatar-upload-btn {
      padding: 8px 16px;
      background: #f5f5f7;
      border: 1px solid #d2d2d7;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }
    .avatar-upload-btn:hover {
      background: #e8e8ed;
    }
    
    /* åŠ¨æ€åˆ—è¡¨ */
    .dynamic-list {
      margin-top: 12px;
    }
    .dynamic-item {
      background: #fafafa;
      border: 1px solid #e5e5ea;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      position: relative;
    }
    .dynamic-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .dynamic-item-title {
      font-weight: 600;
      color: #1d1d1f;
    }
    .dynamic-item-remove {
      background: none;
      border: none;
      color: #ff3b30;
      cursor: pointer;
      font-size: 18px;
      padding: 4px 8px;
    }
    .add-item-btn {
      width: 100%;
      padding: 10px;
      background: white;
      border: 2px dashed #d2d2d7;
      border-radius: 8px;
      color: #0071e3;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
    }
    .add-item-btn:hover {
      border-color: #0071e3;
      background: #f5f5f7;
    }
    
    /* æŠ€èƒ½æ˜Ÿçº§ */
    .skill-rating {
      display: flex;
      gap: 4px;
      margin-top: 8px;
    }
    .skill-rating .star {
      font-size: 20px;
      cursor: pointer;
      color: #d2d2d7;
      transition: color 0.2s;
    }
    .skill-rating .star.active {
      color: #ffcc00;
    }
    
    /* é¢„è§ˆåŒºåŸŸ */
    .preview-content {
      flex: 1;
      padding: 40px;
      overflow-y: auto;
      background: #f5f5f7;
    }
    .resume-preview {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      min-height: 1000px;
    }
    
    /* ç®€å†ä¸»é¢˜æ ·å¼ */
    /* ç»å…¸è“ */
    .theme-classic-blue .resume-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 40px;
      text-align: center;
    }
    .theme-classic-blue .resume-avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      border: 4px solid white;
      margin: 0 auto 20px;
      overflow: hidden;
      background: white;
    }
    .theme-classic-blue .resume-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .theme-classic-blue .resume-name {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 8px;
    }
    .theme-classic-blue .resume-title {
      font-size: 18px;
      opacity: 0.9;
    }
    .theme-classic-blue .resume-contact {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    .theme-classic-blue .resume-body {
      padding: 40px;
    }
    .theme-classic-blue .resume-section {
      margin-bottom: 32px;
    }
    .theme-classic-blue .section-title {
      font-size: 20px;
      font-weight: 700;
      color: #667eea;
      border-bottom: 2px solid #667eea;
      padding-bottom: 8px;
      margin-bottom: 20px;
    }
    
    /* ç°ä»£ç»¿ */
    .theme-modern-green .resume-header {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      color: white;
      padding: 40px;
      text-align: center;
    }
    .theme-modern-green .resume-avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      border: 4px solid white;
      margin: 0 auto 20px;
      overflow: hidden;
      background: white;
    }
    .theme-modern-green .resume-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .theme-modern-green .resume-name {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 8px;
    }
    .theme-modern-green .resume-title {
      font-size: 18px;
      opacity: 0.9;
    }
    .theme-modern-green .resume-contact {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    .theme-modern-green .resume-body {
      padding: 40px;
    }
    .theme-modern-green .resume-section {
      margin-bottom: 32px;
    }
    .theme-modern-green .section-title {
      font-size: 20px;
      font-weight: 700;
      color: #11998e;
      border-bottom: 2px solid #11998e;
      padding-bottom: 8px;
      margin-bottom: 20px;
    }
    
    /* ä¼˜é›…ç´« */
    .theme-elegant-purple .resume-header {
      background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
      color: #5a4a7a;
      padding: 40px;
      text-align: center;
    }
    .theme-elegant-purple .resume-avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      border: 4px solid white;
      margin: 0 auto 20px;
      overflow: hidden;
      background: white;
    }
    .theme-elegant-purple .resume-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .theme-elegant-purple .resume-name {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 8px;
    }
    .theme-elegant-purple .resume-title {
      font-size: 18px;
      opacity: 0.9;
    }
    .theme-elegant-purple .resume-contact {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    .theme-elegant-purple .resume-body {
      padding: 40px;
    }
    .theme-elegant-purple .resume-section {
      margin-bottom: 32px;
    }
    .theme-elegant-purple .section-title {
      font-size: 20px;
      font-weight: 700;
      color: #8e44ad;
      border-bottom: 2px solid #8e44ad;
      padding-bottom: 8px;
      margin-bottom: 20px;
    }
    
    /* æç®€é»‘ */
    .theme-minimal-black .resume-header {
      background: #1d1d1f;
      color: white;
      padding: 40px;
      text-align: center;
    }
    .theme-minimal-black .resume-avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      border: 4px solid white;
      margin: 0 auto 20px;
      overflow: hidden;
      background: white;
    }
    .theme-minimal-black .resume-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .theme-minimal-black .resume-name {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 8px;
    }
    .theme-minimal-black .resume-title {
      font-size: 18px;
      opacity: 0.9;
    }
    .theme-minimal-black .resume-contact {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    .theme-minimal-black .resume-body {
      padding: 40px;
    }
    .theme-minimal-black .resume-section {
      margin-bottom: 32px;
    }
    .theme-minimal-black .section-title {
      font-size: 20px;
      font-weight: 700;
      color: #1d1d1f;
      border-bottom: 2px solid #1d1d1f;
      padding-bottom: 8px;
      margin-bottom: 20px;
    }
    
    /* é€šç”¨ç®€å†æ ·å¼ */
    .basic-info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 16px;
      margin-bottom: 20px;
    }
    .info-item {
      font-size: 14px;
    }
    .info-label {
      color: #666;
      margin-bottom: 4px;
    }
    .info-value {
      color: #1d1d1f;
      font-weight: 500;
    }
    .work-item {
      margin-bottom: 24px;
      padding-bottom: 24px;
      border-bottom: 1px solid #e5e5ea;
    }
    .work-item:last-child {
      border-bottom: none;
    }
    .work-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }
    .work-company {
      font-size: 16px;
      font-weight: 600;
      color: #1d1d1f;
    }
    .work-period {
      font-size: 14px;
      color: #666;
    }
    .work-position {
      font-size: 14px;
      color: #666;
      margin-bottom: 8px;
    }
    .work-content {
      font-size: 14px;
      line-height: 1.6;
      color: #333;
      white-space: pre-wrap;
    }
    .skills-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 16px;
    }
    .skill-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .skill-name {
      font-size: 14px;
      font-weight: 500;
      color: #1d1d1f;
    }
    .skill-stars {
      color: #ffcc00;
      font-size: 16px;
    }
    .other-info {
      font-size: 14px;
      line-height: 1.8;
      color: #333;
      white-space: pre-wrap;
    }
    
    /* Toast æç¤º */
    .toast {
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
      font-size: 14px;
    }
    .toast.show {
      opacity: 1;
    }
    
    /* å¯¼å‡ºèœå• */
    .export-menu {
      position: relative;
    }
    .export-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 4px;
      background: white;
      border: 1px solid #e5e5ea;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      min-width: 150px;
      display: none;
      z-index: 100;
    }
    .export-dropdown.show {
      display: block;
    }
    .export-option {
      padding: 10px 16px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .export-option:hover {
      background: #f5f5f7;
    }
    .export-option:first-child {
      border-radius: 8px 8px 0 0;
    }
    .export-option:last-child {
      border-radius: 0 0 8px 8px;
    }
    
    /* ç§»åŠ¨ç«¯é€‚é… */
    @media (max-width: 768px) {
      .main-content {
        flex-direction: column;
      }
      .editor-panel, .preview-panel {
        max-height: 50vh;
      }
      .header h1 {
        font-size: 16px;
      }
      .toolbar {
        width: 100%;
      }
      .btn {
        padding: 6px 12px;
        font-size: 12px;
      }
      .form-row {
        grid-template-columns: 1fr;
      }
      .preview-content {
        padding: 20px;
      }
      .resume-preview {
        transform: scale(0.85);
        transform-origin: top center;
      }
      .basic-info-grid {
        grid-template-columns: 1fr;
      }
    }
    
    /* ç©ºçŠ¶æ€ */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }
    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- å¤´éƒ¨å·¥å…·æ  -->
    <div class="header">
      <h1>ğŸ“„ åœ¨çº¿ç®€å†åˆ¶ä½œ</h1>
      <div class="toolbar">
        <div class="theme-selector">
          <label>ä¸»é¢˜ï¼š</label>
          <select id="themeSelect">
            <option value="classic-blue">ç»å…¸è“</option>
            <option value="modern-green">ç°ä»£ç»¿</option>
            <option value="elegant-purple">ä¼˜é›…ç´«</option>
            <option value="minimal-black">æç®€é»‘</option>
          </select>
        </div>
        <button class="btn btn-secondary" onclick="document.getElementById('importInput').click()">ğŸ“¤ å¯¼å…¥</button>
        <div class="export-menu">
          <button class="btn btn-primary" onclick="toggleExportMenu()">ğŸ“¥ å¯¼å‡º</button>
          <div class="export-dropdown" id="exportMenu">
            <div class="export-option" onclick="exportMarkdown()">ğŸ“ Markdown</div>
            <div class="export-option" onclick="exportJSON()">ğŸ“‹ JSON</div>
            <div class="export-option" onclick="exportPNG()">ğŸ–¼ï¸ PNG</div>
            <div class="export-option" onclick="exportPDF()">ğŸ“„ PDF</div>
          </div>
        </div>
        <button class="btn btn-danger" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©º</button>
        <input type="file" id="importInput" accept=".json" style="display: none;" onchange="handleImportJSON(event)">
      </div>
    </div>
    
    <!-- ä¸»å†…å®¹åŒº -->
    <div class="main-content">
      <!-- ç¼–è¾‘å™¨é¢æ¿ -->
      <div class="editor-panel">
        <div class="panel-header">ç¼–è¾‘ç®€å†</div>
        <div class="editor-content">
          <!-- åŸºæœ¬ä¿¡æ¯ -->
          <div class="form-section">
            <h3>ğŸ‘¤ åŸºæœ¬ä¿¡æ¯</h3>
            
            <div class="avatar-upload">
              <div class="avatar-preview" id="avatarPreview">
                <span class="avatar-placeholder">ğŸ“·</span>
              </div>
              <label class="avatar-upload-btn">
                ä¸Šä¼ å¤´åƒ
                <input type="file" id="avatarInput" accept="image/*" onchange="handleAvatarUpload(event)">
              </label>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>å§“å *</label>
                <input type="text" id="name" placeholder="è¯·è¾“å…¥å§“å" oninput="updatePreview()">
              </div>
              <div class="form-group">
                <label>å¹´é¾„</label>
                <input type="number" id="age" placeholder="è¯·è¾“å…¥å¹´é¾„" oninput="updatePreview()">
              </div>
              <div class="form-group">
                <label>æ€§åˆ«</label>
                <input type="text" id="gender" placeholder="è¯·è¾“å…¥æ€§åˆ«" oninput="updatePreview()">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>é™¢æ ¡</label>
                <input type="text" id="school" placeholder="è¯·è¾“å…¥é™¢æ ¡" oninput="updatePreview()">
              </div>
              <div class="form-group">
                <label>ä¸“ä¸š</label>
                <input type="text" id="major" placeholder="è¯·è¾“å…¥ä¸“ä¸š" oninput="updatePreview()">
              </div>
              <div class="form-group">
                <label>å­¦å†</label>
                <input type="text" id="education" placeholder="è¯·è¾“å…¥å­¦å†" oninput="updatePreview()">
              </div>
            </div>
            
            <div class="form-group">
              <label>èŒä¸š</label>
              <input type="text" id="profession" placeholder="è¯·è¾“å…¥èŒä¸š" oninput="updatePreview()">
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>é‚®ç®±</label>
                <input type="email" id="email" placeholder="è¯·è¾“å…¥é‚®ç®±" oninput="updatePreview()">
              </div>
              <div class="form-group">
                <label>ç”µè¯</label>
                <input type="tel" id="phone" placeholder="è¯·è¾“å…¥ç”µè¯" oninput="updatePreview()">
              </div>
              <div class="form-group">
                <label>å¾®ä¿¡</label>
                <input type="text" id="wechat" placeholder="è¯·è¾“å…¥å¾®ä¿¡å·" oninput="updatePreview()">
              </div>
            </div>
          </div>
          
          <!-- å·¥ä½œç»å† -->
          <div class="form-section">
            <h3>ğŸ’¼ å·¥ä½œç»å†</h3>
            <div class="dynamic-list" id="workList"></div>
            <button class="add-item-btn" onclick="addWorkExperience()">+ æ·»åŠ å·¥ä½œç»å†</button>
          </div>
          
          <!-- æ ¸å¿ƒæŠ€èƒ½ -->
          <div class="form-section">
            <h3>â­ æ ¸å¿ƒæŠ€èƒ½</h3>
            <div class="dynamic-list" id="skillList"></div>
            <button class="add-item-btn" onclick="addSkill()">+ æ·»åŠ æŠ€èƒ½</button>
          </div>
          
          <!-- å…¶ä»–ä¿¡æ¯ -->
          <div class="form-section">
            <h3>âœ¨ å…¶ä»–ä¿¡æ¯</h3>
            <div class="form-group">
              <textarea id="otherInfo" placeholder="åœ¨è¿™é‡Œæ·»åŠ å…¶ä»–æƒ³è¦å±•ç¤ºçš„ä¿¡æ¯ï¼Œæ¯”å¦‚ä¸ªäººä¼˜åŠ¿ã€è·å¥–ç»å†ã€é¡¹ç›®ç»éªŒç­‰..." oninput="updatePreview()"></textarea>
            </div>
          </div>
        </div>
      </div>
      
      <!-- é¢„è§ˆé¢æ¿ -->
      <div class="preview-panel">
        <div class="panel-header">ç®€å†é¢„è§ˆ</div>
        <div class="preview-content">
          <div class="resume-preview theme-classic-blue" id="resumePreview">
            <!-- é¢„è§ˆå†…å®¹å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Toast æç¤º -->
  <div class="toast" id="toast"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  
  <script>
    // å…¨å±€çŠ¶æ€ï¼ˆå¸¦é»˜è®¤ç¤ºä¾‹æ•°æ®ï¼‰
    let resumeData = {
      avatar: '',
      name: 'å¼ ä¸‰',
      age: '28',
      gender: 'ç”·',
      school: 'æ¸…åå¤§å­¦',
      major: 'è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯',
      education: 'æœ¬ç§‘',
      profession: 'å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ',
      email: 'zhangsan@example.com',
      phone: '138-0000-0000',
      wechat: 'zhangsan_dev',
      workExperiences: [
        {
          company: 'æŸäº’è”ç½‘ç§‘æŠ€å…¬å¸',
          period: '2021.07 - è‡³ä»Š',
          position: 'é«˜çº§å‰ç«¯å·¥ç¨‹å¸ˆ',
          content: 'è´Ÿè´£å…¬å¸æ ¸å¿ƒäº§å“çš„å‰ç«¯æ¶æ„è®¾è®¡ä¸å¼€å‘\n- ä¸»å¯¼å‰ç«¯æŠ€æœ¯æ ˆå‡çº§ï¼Œæ€§èƒ½ä¼˜åŒ–æå‡ 40%\n- å¸¦é¢† 5 äººå›¢é˜Ÿå®Œæˆå¤šä¸ªé‡ç‚¹é¡¹ç›®\n- å»ºç«‹å‰ç«¯ä»£ç è§„èŒƒå’Œè‡ªåŠ¨åŒ–æµ‹è¯•ä½“ç³»'
        },
        {
          company: 'æŸåˆ›ä¸šå…¬å¸',
          period: '2019.07 - 2021.06',
          position: 'å‰ç«¯å·¥ç¨‹å¸ˆ',
          content: 'å‚ä¸å…¬å¸å¤šä¸ª Web åº”ç”¨çš„å¼€å‘ä¸ç»´æŠ¤\n- ç‹¬ç«‹å®Œæˆç”¨æˆ·ç®¡ç†ç³»ç»Ÿçš„å‰ç«¯å¼€å‘\n- ä¼˜åŒ–é¡µé¢åŠ è½½é€Ÿåº¦ï¼Œé¦–å±æ—¶é—´å‡å°‘ 50%\n- å‚ä¸ç§»åŠ¨ç«¯ H5 é¡µé¢å¼€å‘'
        }
      ],
      skills: [
        { name: 'JavaScript/TypeScript', level: 5 },
        { name: 'React/Vue', level: 5 },
        { name: 'Node.js', level: 4 },
        { name: 'Webpack/Vite', level: 4 },
        { name: 'CSS/Sass', level: 5 },
        { name: 'Git', level: 4 }
      ],
      otherInfo: 'â€¢ çƒ­çˆ±æŠ€æœ¯ï¼Œä¿æŒå­¦ä¹ æ–°æŠ€æœ¯çš„çƒ­æƒ…\nâ€¢ å…·å¤‡è‰¯å¥½çš„å›¢é˜Ÿåä½œèƒ½åŠ›å’Œæ²Ÿé€šèƒ½åŠ›\nâ€¢ GitHub å¼€æºé¡¹ç›®è´¡çŒ®è€…ï¼ŒStar æ•° 2000+\nâ€¢ æŠ€æœ¯åšå®¢ç´¯è®¡é˜…è¯»é‡ 10 ä¸‡+\nâ€¢ è·å¾—å…¬å¸å¹´åº¦ä¼˜ç§€å‘˜å·¥å¥–'
    };
    
    // IndexedDB åˆå§‹åŒ–
    let db;
    const DB_NAME = 'ResumeBuilderDB';
    const STORE_NAME = 'resumes';
    
    function initDB() {
      const request = indexedDB.open(DB_NAME, 1);
      
      request.onerror = () => {
        console.error('IndexedDB æ‰“å¼€å¤±è´¥');
        // å³ä½¿æ•°æ®åº“æ‰“å¼€å¤±è´¥ï¼Œä¹Ÿè¦æ˜¾ç¤ºé»˜è®¤æ•°æ®
        restoreFormData();
        updatePreview(true); // è·³è¿‡æ”¶é›†è¡¨å•æ•°æ®ï¼Œç›´æ¥ä½¿ç”¨ resumeData
      };
      
      request.onsuccess = (event) => {
        db = event.target.result;
        loadFromDB();
      };
      
      request.onupgradeneeded = (event) => {
        db = event.target.result;
        if (!db.objectStoreNames.contains(STORE_NAME)) {
          db.createObjectStore(STORE_NAME, { keyPath: 'id' });
        }
      };
    }
    
    // ä¿å­˜åˆ° IndexedDB
    function saveToDB() {
      if (!db) return;
      
      const transaction = db.transaction([STORE_NAME], 'readwrite');
      const store = transaction.objectStore(STORE_NAME);
      const data = {
        id: 'current',
        ...resumeData,
        lastModified: new Date().toISOString()
      };
      store.put(data);
    }
    
    // ä» IndexedDB åŠ è½½
    function loadFromDB() {
      if (!db) return;
      
      const transaction = db.transaction([STORE_NAME], 'readonly');
      const store = transaction.objectStore(STORE_NAME);
      const request = store.get('current');
      
      request.onsuccess = (event) => {
        const data = event.target.result;
        if (data) {
          // æœ‰å†å²æ•°æ®ï¼ŒåŠ è½½å†å²æ•°æ®
          resumeData = { ...data };
          delete resumeData.id;
          delete resumeData.lastModified;
          restoreFormData();
          updatePreview(true); // è·³è¿‡æ”¶é›†è¡¨å•æ•°æ®ï¼Œä½¿ç”¨åŠ è½½çš„æ•°æ®
          showToast('å·²åŠ è½½ä¸Šæ¬¡ç¼–è¾‘çš„å†…å®¹');
        } else {
          // é¦–æ¬¡æ‰“å¼€ï¼Œä½¿ç”¨é»˜è®¤ç¤ºä¾‹æ•°æ®
          restoreFormData();
          updatePreview(true); // è·³è¿‡æ”¶é›†è¡¨å•æ•°æ®ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®
          showToast('æ¬¢è¿ä½¿ç”¨ï¼è¿™æ˜¯ä¸€ä»½ç¤ºä¾‹ç®€å†ï¼Œæ‚¨å¯ä»¥ç›´æ¥ç¼–è¾‘');
        }
      };
    }
    
    // æ¢å¤è¡¨å•æ•°æ®
    function restoreFormData() {
      // åŸºæœ¬ä¿¡æ¯
      document.getElementById('name').value = resumeData.name || '';
      document.getElementById('age').value = resumeData.age || '';
      document.getElementById('gender').value = resumeData.gender || '';
      document.getElementById('school').value = resumeData.school || '';
      document.getElementById('major').value = resumeData.major || '';
      document.getElementById('education').value = resumeData.education || '';
      document.getElementById('profession').value = resumeData.profession || '';
      document.getElementById('email').value = resumeData.email || '';
      document.getElementById('phone').value = resumeData.phone || '';
      document.getElementById('wechat').value = resumeData.wechat || '';
      document.getElementById('otherInfo').value = resumeData.otherInfo || '';
      
      // å¤´åƒ
      if (resumeData.avatar) {
        const avatarPreview = document.getElementById('avatarPreview');
        avatarPreview.innerHTML = `<img src="${resumeData.avatar}" alt="å¤´åƒ">`;
      }
      
      // å·¥ä½œç»å† - ä½¿ç”¨ skipUpdate å‚æ•°é¿å…å¤šæ¬¡è§¦å‘é¢„è§ˆæ›´æ–°
      resumeData.workExperiences.forEach(work => {
        addWorkExperience(work, true);
      });
      
      // æŠ€èƒ½ - ä½¿ç”¨ skipUpdate å‚æ•°é¿å…å¤šæ¬¡è§¦å‘é¢„è§ˆæ›´æ–°
      resumeData.skills.forEach(skill => {
        addSkill(skill, true);
      });
    }
    
    // æ”¶é›†è¡¨å•æ•°æ®
    function collectFormData() {
      resumeData.name = document.getElementById('name').value;
      resumeData.age = document.getElementById('age').value;
      resumeData.gender = document.getElementById('gender').value;
      resumeData.school = document.getElementById('school').value;
      resumeData.major = document.getElementById('major').value;
      resumeData.education = document.getElementById('education').value;
      resumeData.profession = document.getElementById('profession').value;
      resumeData.email = document.getElementById('email').value;
      resumeData.phone = document.getElementById('phone').value;
      resumeData.wechat = document.getElementById('wechat').value;
      resumeData.otherInfo = document.getElementById('otherInfo').value;
      
      // æ”¶é›†å·¥ä½œç»å†
      resumeData.workExperiences = [];
      document.querySelectorAll('#workList .dynamic-item').forEach(item => {
        const id = item.dataset.id;
        resumeData.workExperiences.push({
          company: document.getElementById(`work-company-${id}`).value,
          period: document.getElementById(`work-period-${id}`).value,
          position: document.getElementById(`work-position-${id}`).value,
          content: document.getElementById(`work-content-${id}`).value
        });
      });
      
      // æ”¶é›†æŠ€èƒ½
      resumeData.skills = [];
      document.querySelectorAll('#skillList .dynamic-item').forEach(item => {
        const id = item.dataset.id;
        const stars = item.querySelectorAll('.star.active').length;
        resumeData.skills.push({
          name: document.getElementById(`skill-name-${id}`).value,
          level: stars
        });
      });
    }
    
    // æ·»åŠ å·¥ä½œç»å†
    let workIdCounter = 0;
    function addWorkExperience(data = null, skipUpdate = false) {
      const id = workIdCounter++;
      const workList = document.getElementById('workList');
      const item = document.createElement('div');
      item.className = 'dynamic-item';
      item.dataset.id = id;
      
      item.innerHTML = `
        <div class="dynamic-item-header">
          <span class="dynamic-item-title">å·¥ä½œç»å† ${workList.children.length + 1}</span>
          <button class="dynamic-item-remove" onclick="removeWorkExperience(${id})">Ã—</button>
        </div>
        <div class="form-group">
          <label>å…¬å¸åç§°</label>
          <input type="text" id="work-company-${id}" value="${data?.company || ''}" placeholder="è¯·è¾“å…¥å…¬å¸åç§°" oninput="updatePreview()">
        </div>
        <div class="form-group">
          <label>èµ·æ­¢æ—¶é—´</label>
          <input type="text" id="work-period-${id}" value="${data?.period || ''}" placeholder="å¦‚ï¼š2020.01 - 2023.12" oninput="updatePreview()">
        </div>
        <div class="form-group">
          <label>èŒä½/èŒç§°</label>
          <input type="text" id="work-position-${id}" value="${data?.position || ''}" placeholder="è¯·è¾“å…¥èŒä½" oninput="updatePreview()">
        </div>
        <div class="form-group">
          <label>å·¥ä½œå†…å®¹</label>
          <textarea id="work-content-${id}" placeholder="æè¿°ä¸»è¦å·¥ä½œå†…å®¹å’Œæˆæœ..." oninput="updatePreview()">${data?.content || ''}</textarea>
        </div>
      `;
      
      workList.appendChild(item);
      if (!skipUpdate) {
        updatePreview();
      }
    }
    
    // åˆ é™¤å·¥ä½œç»å†
    function removeWorkExperience(id) {
      const item = document.querySelector(`#workList .dynamic-item[data-id="${id}"]`);
      if (item) {
        item.remove();
        updatePreview();
      }
    }
    
    // æ·»åŠ æŠ€èƒ½
    let skillIdCounter = 0;
    function addSkill(data = null, skipUpdate = false) {
      const id = skillIdCounter++;
      const skillList = document.getElementById('skillList');
      const item = document.createElement('div');
      item.className = 'dynamic-item';
      item.dataset.id = id;
      
      item.innerHTML = `
        <div class="dynamic-item-header">
          <span class="dynamic-item-title">æŠ€èƒ½ ${skillList.children.length + 1}</span>
          <button class="dynamic-item-remove" onclick="removeSkill(${id})">Ã—</button>
        </div>
        <div class="form-group">
          <label>æŠ€èƒ½åç§°</label>
          <input type="text" id="skill-name-${id}" value="${data?.name || ''}" placeholder="å¦‚ï¼šJavaScript" oninput="updatePreview()">
        </div>
        <div class="form-group">
          <label>ç†Ÿç»ƒç¨‹åº¦</label>
          <div class="skill-rating" id="skill-rating-${id}">
            ${[1,2,3,4,5].map(i => `<span class="star ${data && i <= data.level ? 'active' : ''}" onclick="setSkillLevel(${id}, ${i})">â˜…</span>`).join('')}
          </div>
        </div>
      `;
      
      skillList.appendChild(item);
      if (!skipUpdate) {
        updatePreview();
      }
    }
    
    // åˆ é™¤æŠ€èƒ½
    function removeSkill(id) {
      const item = document.querySelector(`#skillList .dynamic-item[data-id="${id}"]`);
      if (item) {
        item.remove();
        updatePreview();
      }
    }
    
    // è®¾ç½®æŠ€èƒ½ç­‰çº§
    function setSkillLevel(skillId, level) {
      const rating = document.getElementById(`skill-rating-${skillId}`);
      const stars = rating.querySelectorAll('.star');
      stars.forEach((star, index) => {
        if (index < level) {
          star.classList.add('active');
        } else {
          star.classList.remove('active');
        }
      });
      updatePreview();
    }
    
    // å¤´åƒä¸Šä¼ 
    function handleAvatarUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = (e) => {
        resumeData.avatar = e.target.result;
        const avatarPreview = document.getElementById('avatarPreview');
        avatarPreview.innerHTML = `<img src="${e.target.result}" alt="å¤´åƒ">`;
        updatePreview();
      };
      reader.readAsDataURL(file);
    }
    
    // æ›´æ–°é¢„è§ˆ
    function updatePreview(skipCollect = false) {
      if (!skipCollect) {
        collectFormData();
      }
      saveToDB();
      
      const preview = document.getElementById('resumePreview');
      const theme = document.getElementById('themeSelect').value;
      preview.className = `resume-preview theme-${theme}`;
      
      // ç”Ÿæˆé¢„è§ˆ HTML
      let html = '';
      
      // å¤´éƒ¨
      html += '<div class="resume-header">';
      if (resumeData.avatar) {
        html += `<div class="resume-avatar"><img src="${resumeData.avatar}" alt="å¤´åƒ"></div>`;
      }
      html += `<div class="resume-name">${resumeData.name || 'å§“å'}</div>`;
      html += `<div class="resume-title">${resumeData.profession || 'èŒä¸š'}</div>`;
      
      // è”ç³»æ–¹å¼
      const contacts = [];
      if (resumeData.email) contacts.push(`ğŸ“§ ${resumeData.email}`);
      if (resumeData.phone) contacts.push(`ğŸ“± ${resumeData.phone}`);
      if (resumeData.wechat) contacts.push(`ğŸ’¬ ${resumeData.wechat}`);
      if (contacts.length > 0) {
        html += `<div class="resume-contact">${contacts.join(' | ')}</div>`;
      }
      html += '</div>';
      
      // ä¸»ä½“
      html += '<div class="resume-body">';
      
      // åŸºæœ¬ä¿¡æ¯
      const hasBasicInfo = resumeData.age || resumeData.gender || resumeData.school || resumeData.major || resumeData.education;
      if (hasBasicInfo) {
        html += '<div class="resume-section">';
        html += '<div class="section-title">åŸºæœ¬ä¿¡æ¯</div>';
        html += '<div class="basic-info-grid">';
        if (resumeData.age) html += `<div class="info-item"><div class="info-label">å¹´é¾„</div><div class="info-value">${resumeData.age}</div></div>`;
        if (resumeData.gender) html += `<div class="info-item"><div class="info-label">æ€§åˆ«</div><div class="info-value">${resumeData.gender}</div></div>`;
        if (resumeData.school) html += `<div class="info-item"><div class="info-label">é™¢æ ¡</div><div class="info-value">${resumeData.school}</div></div>`;
        if (resumeData.major) html += `<div class="info-item"><div class="info-label">ä¸“ä¸š</div><div class="info-value">${resumeData.major}</div></div>`;
        if (resumeData.education) html += `<div class="info-item"><div class="info-label">å­¦å†</div><div class="info-value">${resumeData.education}</div></div>`;
        html += '</div></div>';
      }
      
      // å·¥ä½œç»å†
      if (resumeData.workExperiences.length > 0) {
        html += '<div class="resume-section">';
        html += '<div class="section-title">å·¥ä½œç»å†</div>';
        resumeData.workExperiences.forEach(work => {
          html += '<div class="work-item">';
          html += `<div class="work-header">`;
          html += `<div class="work-company">${work.company || 'å…¬å¸åç§°'}</div>`;
          html += `<div class="work-period">${work.period || 'æ—¶é—´'}</div>`;
          html += `</div>`;
          if (work.position) html += `<div class="work-position">${work.position}</div>`;
          if (work.content) html += `<div class="work-content">${work.content}</div>`;
          html += '</div>';
        });
        html += '</div>';
      }
      
      // æ ¸å¿ƒæŠ€èƒ½
      if (resumeData.skills.length > 0) {
        html += '<div class="resume-section">';
        html += '<div class="section-title">æ ¸å¿ƒæŠ€èƒ½</div>';
        html += '<div class="skills-grid">';
        resumeData.skills.forEach(skill => {
          if (skill.name) {
            html += '<div class="skill-item">';
            html += `<div class="skill-name">${skill.name}</div>`;
            html += `<div class="skill-stars">${'â˜…'.repeat(skill.level)}${'â˜†'.repeat(5 - skill.level)}</div>`;
            html += '</div>';
          }
        });
        html += '</div></div>';
      }
      
      // å…¶ä»–ä¿¡æ¯
      if (resumeData.otherInfo) {
        html += '<div class="resume-section">';
        html += '<div class="section-title">å…¶ä»–ä¿¡æ¯</div>';
        html += `<div class="other-info">${resumeData.otherInfo}</div>`;
        html += '</div>';
      }
      
      // ç©ºçŠ¶æ€
      if (!hasBasicInfo && resumeData.workExperiences.length === 0 && resumeData.skills.length === 0 && !resumeData.otherInfo) {
        html += '<div class="empty-state">';
        html += '<div class="empty-state-icon">ğŸ“</div>';
        html += '<div>å¼€å§‹å¡«å†™ä½ çš„ç®€å†å§</div>';
        html += '</div>';
      }
      
      html += '</div>';
      
      preview.innerHTML = html;
    }
    
    // ä¸»é¢˜åˆ‡æ¢
    document.getElementById('themeSelect').addEventListener('change', () => {
      updatePreview();
    });
    
    // æ¸…ç©ºæ‰€æœ‰å†…å®¹
    function clearAll() {
      if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†…å®¹å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) return;
      
      resumeData = {
        avatar: '',
        name: '',
        age: '',
        gender: '',
        school: '',
        major: '',
        education: '',
        profession: '',
        email: '',
        phone: '',
        wechat: '',
        workExperiences: [],
        skills: [],
        otherInfo: ''
      };
      
      // æ¸…ç©ºè¡¨å•
      document.querySelectorAll('input, textarea').forEach(el => el.value = '');
      document.getElementById('avatarPreview').innerHTML = '<span class="avatar-placeholder">ğŸ“·</span>';
      document.getElementById('workList').innerHTML = '';
      document.getElementById('skillList').innerHTML = '';
      workIdCounter = 0;
      skillIdCounter = 0;
      
      updatePreview();
      saveToDB();
      showToast('å·²æ¸…ç©ºæ‰€æœ‰å†…å®¹');
    }
    
    // å¯¼å‡ºèœå•
    function toggleExportMenu() {
      const menu = document.getElementById('exportMenu');
      menu.classList.toggle('show');
    }
    
    // ç‚¹å‡»å¤–éƒ¨å…³é—­èœå•
    document.addEventListener('click', (e) => {
      const menu = document.getElementById('exportMenu');
      const exportBtn = e.target.closest('.export-menu');
      if (!exportBtn && menu.classList.contains('show')) {
        menu.classList.remove('show');
      }
    });
    
    // å¯¼å‡º Markdown
    function exportMarkdown() {
      collectFormData();
      let md = `# ${resumeData.name || 'ç®€å†'}\n\n`;
      
      // åŸºæœ¬ä¿¡æ¯
      md += `## åŸºæœ¬ä¿¡æ¯\n\n`;
      if (resumeData.profession) md += `**èŒä¸š**: ${resumeData.profession}\n\n`;
      if (resumeData.age) md += `**å¹´é¾„**: ${resumeData.age}\n\n`;
      if (resumeData.gender) md += `**æ€§åˆ«**: ${resumeData.gender}\n\n`;
      if (resumeData.school) md += `**é™¢æ ¡**: ${resumeData.school}\n\n`;
      if (resumeData.major) md += `**ä¸“ä¸š**: ${resumeData.major}\n\n`;
      if (resumeData.education) md += `**å­¦å†**: ${resumeData.education}\n\n`;
      
      // è”ç³»æ–¹å¼
      md += `## è”ç³»æ–¹å¼\n\n`;
      if (resumeData.email) md += `- ğŸ“§ ${resumeData.email}\n`;
      if (resumeData.phone) md += `- ğŸ“± ${resumeData.phone}\n`;
      if (resumeData.wechat) md += `- ğŸ’¬ ${resumeData.wechat}\n`;
      md += `\n`;
      
      // å·¥ä½œç»å†
      if (resumeData.workExperiences.length > 0) {
        md += `## å·¥ä½œç»å†\n\n`;
        resumeData.workExperiences.forEach(work => {
          md += `### ${work.company}\n\n`;
          md += `**æ—¶é—´**: ${work.period}\n\n`;
          if (work.position) md += `**èŒä½**: ${work.position}\n\n`;
          if (work.content) md += `${work.content}\n\n`;
        });
      }
      
      // æ ¸å¿ƒæŠ€èƒ½
      if (resumeData.skills.length > 0) {
        md += `## æ ¸å¿ƒæŠ€èƒ½\n\n`;
        resumeData.skills.forEach(skill => {
          md += `- ${skill.name}: ${'â˜…'.repeat(skill.level)}${'â˜†'.repeat(5 - skill.level)}\n`;
        });
        md += `\n`;
      }
      
      // å…¶ä»–ä¿¡æ¯
      if (resumeData.otherInfo) {
        md += `## å…¶ä»–ä¿¡æ¯\n\n${resumeData.otherInfo}\n`;
      }
      
      downloadFile(md, 'resume.md', 'text/markdown');
      toggleExportMenu();
      showToast('Markdown å¯¼å‡ºæˆåŠŸ');
    }
    
    // å¯¼å‡º JSON
    function exportJSON() {
      collectFormData();
      const json = JSON.stringify(resumeData, null, 2);
      downloadFile(json, 'resume.json', 'application/json');
      toggleExportMenu();
      showToast('JSON å¯¼å‡ºæˆåŠŸ');
    }
    
    // å¯¼å…¥ JSON
    function handleImportJSON(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      // éªŒè¯æ–‡ä»¶ç±»å‹
      if (!file.name.endsWith('.json')) {
        showToast('è¯·é€‰æ‹© JSON æ–‡ä»¶', 'error');
        event.target.value = ''; // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©
        return;
      }
      
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const importedData = JSON.parse(e.target.result);
          
          // éªŒè¯æ•°æ®ç»“æ„
          if (!validateResumeData(importedData)) {
            showToast('JSON æ•°æ®æ ¼å¼ä¸æ­£ç¡®', 'error');
            return;
          }
          
          // ç¡®è®¤å¯¼å…¥
          if (!confirm('å¯¼å…¥å°†è¦†ç›–å½“å‰æ‰€æœ‰å†…å®¹ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ')) {
            return;
          }
          
          // æ¸…ç©ºç°æœ‰è¡¨å•
          document.getElementById('workList').innerHTML = '';
          document.getElementById('skillList').innerHTML = '';
          workIdCounter = 0;
          skillIdCounter = 0;
          
          // æ›´æ–°æ•°æ®
          resumeData = {
            avatar: importedData.avatar || '',
            name: importedData.name || '',
            age: importedData.age || '',
            gender: importedData.gender || '',
            school: importedData.school || '',
            major: importedData.major || '',
            education: importedData.education || '',
            profession: importedData.profession || '',
            email: importedData.email || '',
            phone: importedData.phone || '',
            wechat: importedData.wechat || '',
            workExperiences: Array.isArray(importedData.workExperiences) ? importedData.workExperiences : [],
            skills: Array.isArray(importedData.skills) ? importedData.skills : [],
            otherInfo: importedData.otherInfo || ''
          };
          
          // æ¢å¤è¡¨å•æ•°æ®
          restoreFormData();
          
          // æ›´æ–°é¢„è§ˆå¹¶ä¿å­˜
          updatePreview(true);
          saveToDB();
          
          showToast('å¯¼å…¥æˆåŠŸ');
        } catch (error) {
          console.error('å¯¼å…¥å¤±è´¥:', error);
          showToast('JSON æ–‡ä»¶è§£æå¤±è´¥', 'error');
        }
      };
      
      reader.onerror = () => {
        showToast('æ–‡ä»¶è¯»å–å¤±è´¥', 'error');
      };
      
      reader.readAsText(file);
      
      // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©ï¼Œå…è®¸é‡å¤å¯¼å…¥åŒä¸€æ–‡ä»¶
      event.target.value = '';
    }
    
    // éªŒè¯ç®€å†æ•°æ®ç»“æ„
    function validateResumeData(data) {
      if (!data || typeof data !== 'object') {
        return false;
      }
      
      // æ£€æŸ¥å¿…è¦çš„å­—æ®µç±»å‹
      const stringFields = ['avatar', 'name', 'age', 'gender', 'school', 'major', 'education', 'profession', 'email', 'phone', 'wechat', 'otherInfo'];
      for (const field of stringFields) {
        if (data[field] !== undefined && typeof data[field] !== 'string') {
          return false;
        }
      }
      
      // æ£€æŸ¥å·¥ä½œç»å†æ•°ç»„
      if (data.workExperiences !== undefined) {
        if (!Array.isArray(data.workExperiences)) {
          return false;
        }
        for (const work of data.workExperiences) {
          if (typeof work !== 'object' || 
              (work.company !== undefined && typeof work.company !== 'string') ||
              (work.period !== undefined && typeof work.period !== 'string') ||
              (work.position !== undefined && typeof work.position !== 'string') ||
              (work.content !== undefined && typeof work.content !== 'string')) {
            return false;
          }
        }
      }
      
      // æ£€æŸ¥æŠ€èƒ½æ•°ç»„
      if (data.skills !== undefined) {
        if (!Array.isArray(data.skills)) {
          return false;
        }
        for (const skill of data.skills) {
          if (typeof skill !== 'object' ||
              (skill.name !== undefined && typeof skill.name !== 'string') ||
              (skill.level !== undefined && (typeof skill.level !== 'number' || skill.level < 0 || skill.level > 5))) {
            return false;
          }
        }
      }
      
      return true;
    }
    
    // å¯¼å‡º PNG
    async function exportPNG() {
      toggleExportMenu();
      showToast('æ­£åœ¨ç”Ÿæˆ PNG...');
      
      const element = document.getElementById('resumePreview');
      try {
        const canvas = await html2canvas(element, {
          scale: 2,
          useCORS: true,
          backgroundColor: '#ffffff'
        });
        
        canvas.toBlob((blob) => {
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'resume.png';
          a.click();
          URL.revokeObjectURL(url);
          showToast('PNG å¯¼å‡ºæˆåŠŸ');
        });
      } catch (error) {
        showToast('PNG å¯¼å‡ºå¤±è´¥', 'error');
        console.error(error);
      }
    }
    
    // å¯¼å‡º PDF
    async function exportPDF() {
      toggleExportMenu();
      showToast('æ­£åœ¨ç”Ÿæˆ PDF...');
      
      const element = document.getElementById('resumePreview');
      try {
        const canvas = await html2canvas(element, {
          scale: 2,
          useCORS: true,
          backgroundColor: '#ffffff'
        });
        
        const imgData = canvas.toDataURL('image/png');
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({
          orientation: 'portrait',
          unit: 'mm',
          format: 'a4'
        });
        
        // A4 çº¸å¼ å°ºå¯¸ï¼ˆmmï¼‰
        const pageWidth = 210;
        const pageHeight = 297;
        
        // è®¡ç®—å›¾ç‰‡åœ¨ PDF ä¸­çš„å°ºå¯¸
        const imgWidth = pageWidth;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;
        
        // å¦‚æœå†…å®¹é«˜åº¦å°äºä¸€é¡µï¼Œç›´æ¥æ·»åŠ 
        if (imgHeight <= pageHeight) {
          pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
        } else {
          // å†…å®¹è¶…è¿‡ä¸€é¡µï¼Œéœ€è¦åˆ†é¡µ
          let heightLeft = imgHeight;
          let position = 0;
          
          // æ·»åŠ ç¬¬ä¸€é¡µ
          pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
          heightLeft -= pageHeight;
          
          // æ·»åŠ åç»­é¡µé¢
          while (heightLeft > 0) {
            position = heightLeft - imgHeight;
            pdf.addPage();
            pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;
          }
        }
        
        pdf.save('resume.pdf');
        showToast('PDF å¯¼å‡ºæˆåŠŸ');
      } catch (error) {
        showToast('PDF å¯¼å‡ºå¤±è´¥', 'error');
        console.error(error);
      }
    }
    
    // ä¸‹è½½æ–‡ä»¶
    function downloadFile(content, filename, type) {
      const blob = new Blob([content], { type });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
    }
    
    // Toast æç¤º
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }
    
    // åˆå§‹åŒ–
    window.addEventListener('DOMContentLoaded', () => {
      initDB();
      // ä¸åœ¨è¿™é‡Œè°ƒç”¨ updatePreview()ï¼Œç­‰å¾… loadFromDB() å®Œæˆåå†è°ƒç”¨
    });
    
    // é¡µé¢å¸è½½å‰ä¿å­˜
    window.addEventListener('beforeunload', () => {
      saveToDB();
    });
  </script>
</body>
</html>