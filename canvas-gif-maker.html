<!-- Canvas ç”»å›¾ä¸ GIF åŠ¨å›¾åˆ¶ä½œå·¥å…·ï¼ˆå•æ–‡ä»¶HTMLå®ç°ï¼Œæ— éœ€æ„å»ºæ­¥éª¤ï¼‰-->
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Canvas ç”»å›¾ä¸ GIF åŠ¨å›¾åˆ¶ä½œå·¥å…·</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: system-ui, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.1);
    }
    h1 {
      font-size: 24px;
      margin-bottom: 20px;
      color: #333;
    }
    .main-layout {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 24px;
    }
    
    /* å·¦ä¾§ä¹å®«æ ¼åŒºåŸŸ */
    .left-panel {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .grid-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      background: #f9f9f9;
      padding: 12px;
      border-radius: 8px;
    }
    .grid-item {
      position: relative;
      aspect-ratio: 1;
      background: white;
      border: 2px dashed #ddd;
      border-radius: 6px;
      cursor: pointer;
      overflow: hidden;
      transition: all 0.2s;
    }
    .grid-item:hover {
      border-color: #006aff;
      transform: scale(1.05);
    }
    .grid-item.filled {
      border-style: solid;
      border-color: #006aff;
    }
    .grid-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .grid-item .placeholder {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #999;
      font-size: 32px;
    }
    .grid-item .delete-btn {
      position: absolute;
      top: 4px;
      right: 4px;
      width: 24px;
      height: 24px;
      background: rgba(220, 53, 69, 0.9);
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      font-size: 14px;
      display: none;
      align-items: center;
      justify-content: center;
    }
    .grid-item.filled:hover .delete-btn {
      display: flex;
    }
    
    /* GIF æ§åˆ¶åŒºåŸŸ */
    .gif-controls {
      background: #f9f9f9;
      padding: 16px;
      border-radius: 8px;
    }
    .control-group {
      margin-bottom: 12px;
    }
    .control-group label {
      display: block;
      font-size: 14px;
      color: #666;
      margin-bottom: 6px;
    }
    .slider-container {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .slider-container input[type="range"] {
      flex: 1;
    }
    .slider-value {
      min-width: 60px;
      text-align: right;
      font-weight: 600;
      color: #333;
    }
    
    /* å³ä¾§ç”»å¸ƒåŒºåŸŸ */
    .right-panel {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .canvas-container {
      display: flex;
      justify-content: center;
      background: #f9f9f9;
      padding: 20px;
      border-radius: 8px;
    }
    #drawCanvas {
      border: 2px solid #ddd;
      cursor: crosshair;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    /* å·¥å…·æ  */
    .toolbar {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
      background: #f9f9f9;
      padding: 16px;
      border-radius: 8px;
    }
    .toolbar-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .toolbar-group label {
      font-size: 14px;
      color: #666;
      white-space: nowrap;
    }
    .color-picker {
      width: 50px;
      height: 40px;
      border: 2px solid #ddd;
      border-radius: 6px;
      cursor: pointer;
    }
    
    /* æŒ‰é’®æ ·å¼ */
    button {
      padding: 10px 20px;
      font-size: 15px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 500;
    }
    .btn-primary {
      background: #006aff;
      color: white;
    }
    .btn-primary:hover { background: #0056cc; }
    .btn-primary:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .btn-success {
      background: #28a745;
      color: white;
    }
    .btn-success:hover { background: #218838; }
    .btn-danger {
      background: #dc3545;
      color: white;
    }
    .btn-danger:hover { background: #c82333; }
    .btn-secondary {
      background: #6c757d;
      color: white;
    }
    .btn-secondary:hover { background: #5a6268; }
    
    .file-input {
      display: none;
    }
    
    .info-box {
      background: #e7f3ff;
      border: 1px solid #b3d9ff;
      border-radius: 6px;
      padding: 12px;
      font-size: 14px;
      color: #004085;
    }
    
    .status-message {
      padding: 10px;
      border-radius: 6px;
      margin-top: 12px;
      font-size: 14px;
      display: none;
    }
    .status-message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .status-message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .status-message.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    
    @media (max-width: 1024px) {
      .main-layout {
        grid-template-columns: 1fr;
      }
      .left-panel {
        order: 2;
      }
      .right-panel {
        order: 1;
      }
    }
    
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      .container {
        padding: 16px;
        border-radius: 8px;
      }
      h1 {
        font-size: 20px;
        margin-bottom: 16px;
      }
      .main-layout {
        gap: 16px;
      }
      
      /* ä¹å®«æ ¼ä¼˜åŒ– */
      .grid-container {
        padding: 8px;
        gap: 6px;
      }
      .grid-item .placeholder {
        font-size: 24px;
      }
      .grid-item .delete-btn {
        width: 28px;
        height: 28px;
        font-size: 16px;
        display: flex; /* ç§»åŠ¨ç«¯å§‹ç»ˆæ˜¾ç¤ºåˆ é™¤æŒ‰é’® */
      }
      
      /* GIF æ§åˆ¶åŒºåŸŸ */
      .gif-controls {
        padding: 12px;
      }
      .control-group {
        margin-bottom: 10px;
      }
      .control-group label {
        font-size: 13px;
      }
      .slider-value {
        font-size: 13px;
        min-width: 50px;
      }
      
      /* ç”»å¸ƒå®¹å™¨ */
      .canvas-container {
        padding: 12px;
        overflow-x: auto;
      }
      #drawCanvas {
        max-width: 100%;
        height: auto;
        touch-action: none;
      }
      
      /* å·¥å…·æ  */
      .toolbar {
        padding: 12px;
        gap: 8px;
      }
      .toolbar-group {
        gap: 6px;
      }
      .toolbar-group label {
        font-size: 13px;
      }
      .color-picker {
        width: 40px;
        height: 36px;
      }
      button {
        padding: 8px 14px;
        font-size: 14px;
      }
      
      /* ä¿¡æ¯æ¡† */
      .info-box {
        padding: 10px;
        font-size: 13px;
        line-height: 1.6;
      }
      
      /* çŠ¶æ€æ¶ˆæ¯ */
      .status-message {
        font-size: 13px;
        padding: 8px;
      }
    }
    
    @media (max-width: 480px) {
      body {
        padding: 5px;
      }
      .container {
        padding: 12px;
      }
      h1 {
        font-size: 18px;
        margin-bottom: 12px;
      }
      
      /* å·¥å…·æ ç´§å‡‘å¸ƒå±€ */
      .toolbar {
        padding: 10px;
        gap: 6px;
      }
      .toolbar-group {
        flex-wrap: wrap;
      }
      button {
        padding: 8px 12px;
        font-size: 13px;
      }
      
      /* ç”»å¸ƒé€‚é…å°å±å¹• */
      .canvas-container {
        padding: 8px;
      }
      
      /* ä¹å®«æ ¼æ›´ç´§å‡‘ */
      .grid-container {
        padding: 6px;
        gap: 4px;
      }
    }
  </style>
  <!-- ä½¿ç”¨ gifshot åº“è¿›è¡Œ GIF ç¼–ç  -->
  <script src="https://cdn.jsdelivr.net/npm/gifshot@0.4.5/dist/gifshot.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>ğŸ¨ Canvas ç”»å›¾ä¸ GIF åŠ¨å›¾åˆ¶ä½œå·¥å…·</h1>
    
    <div class="main-layout">
      <!-- å·¦ä¾§ï¼šä¹å®«æ ¼å’Œ GIF æ§åˆ¶ -->
      <div class="left-panel">
        <div class="grid-container" id="gridContainer">
          <!-- ä¹å®«æ ¼å°†é€šè¿‡ JS åŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <div class="gif-controls">
          <div class="control-group">
            <label>å¸§åˆ‡æ¢é€Ÿåº¦</label>
            <div class="slider-container">
              <input type="range" id="frameDelay" min="100" max="2000" value="500" step="50">
              <span class="slider-value" id="frameDelayValue">500ms</span>
            </div>
          </div>
          
          <button class="btn-success" id="generateGifBtn" style="width: 100%; margin-top: 12px;" disabled>
            ğŸ¬ åˆæˆ GIF åŠ¨å›¾
          </button>
          
          <div class="status-message" id="gifStatus"></div>
        </div>
        
        <div class="info-box">
          <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
          â€¢ åœ¨å³ä¾§ç”»å¸ƒç»˜ç”»åç‚¹å‡»"å®Œæˆ"æ·»åŠ åˆ°ä¹å®«æ ¼<br>
          â€¢ ç‚¹å‡»ä¹å®«æ ¼æ ¼å­å¯ä¸Šä¼ æœ¬åœ°å›¾ç‰‡<br>
          â€¢ è‡³å°‘éœ€è¦ 3 å¼ å›¾ç‰‡æ‰èƒ½åˆæˆ GIF<br>
          â€¢ æœ€å¤šæ”¯æŒ 9 å¼ å›¾ç‰‡
        </div>
      </div>
      
      <!-- å³ä¾§ï¼šç”»å¸ƒå’Œå·¥å…·æ  -->
      <div class="right-panel">
        <div class="toolbar">
          <div class="toolbar-group">
            <label>èƒŒæ™¯è‰²:</label>
            <input type="color" id="bgColor" class="color-picker" value="#ffffff">
          </div>
          
          <div class="toolbar-group">
            <label>ç”»ç¬”è‰²:</label>
            <input type="color" id="penColor" class="color-picker" value="#000000">
          </div>
          
          <div class="toolbar-group">
            <label>ç”»ç¬”ç²—ç»†:</label>
            <input type="range" id="penSize" min="1" max="20" value="3">
            <span id="penSizeValue">3px</span>
          </div>
          
          <button class="btn-secondary" id="clearBtn">æ¸…ç©ºç”»å¸ƒ</button>
          <button class="btn-primary" id="finishBtn">âœ“ å®Œæˆ</button>
          <button class="btn-secondary" id="uploadToCanvasBtn">ğŸ“ ä¸Šä¼ å›¾ç‰‡åˆ°ç”»å¸ƒ</button>
          <input type="file" id="uploadToCanvas" class="file-input" accept="image/*">
        </div>
        
        <div class="canvas-container">
          <canvas id="drawCanvas" width="500" height="500"></canvas>
        </div>
        
        <div class="status-message" id="canvasStatus"></div>
      </div>
    </div>
  </div>
  
  <!-- éšè—çš„æ–‡ä»¶ä¸Šä¼ è¾“å…¥ -->
  <input type="file" id="uploadToGrid" class="file-input" accept="image/*">

  <script>
    // å…¨å±€å˜é‡
    const canvas = document.getElementById('drawCanvas');
    const ctx = canvas.getContext('2d');
    const gridContainer = document.getElementById('gridContainer');
    const bgColorInput = document.getElementById('bgColor');
    const penColorInput = document.getElementById('penColor');
    const penSizeInput = document.getElementById('penSize');
    const penSizeValue = document.getElementById('penSizeValue');
    const clearBtn = document.getElementById('clearBtn');
    const finishBtn = document.getElementById('finishBtn');
    const generateGifBtn = document.getElementById('generateGifBtn');
    const frameDelayInput = document.getElementById('frameDelay');
    const frameDelayValue = document.getElementById('frameDelayValue');
    const uploadToCanvasBtn = document.getElementById('uploadToCanvasBtn');
    const uploadToCanvasInput = document.getElementById('uploadToCanvas');
    const uploadToGridInput = document.getElementById('uploadToGrid');
    const canvasStatus = document.getElementById('canvasStatus');
    const gifStatus = document.getElementById('gifStatus');
    
    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;
    let gridImages = Array(9).fill(null); // å­˜å‚¨ä¹å®«æ ¼å›¾ç‰‡ï¼Œåˆå§‹åŒ–ä¸º 9 ä¸ª null
    let currentUploadIndex = -1; // å½“å‰ä¸Šä¼ åˆ°å“ªä¸ªæ ¼å­
    
    // åˆå§‹åŒ–ç”»å¸ƒ
    function initCanvas() {
      // å“åº”å¼ç”»å¸ƒå°ºå¯¸
      const containerWidth = canvas.parentElement.clientWidth - 40;
      const maxSize = 500;
      
      if (window.innerWidth <= 768) {
        const size = Math.min(containerWidth, maxSize);
        canvas.width = size;
        canvas.height = size;
      } else {
        canvas.width = maxSize;
        canvas.height = maxSize;
      }
      
      ctx.fillStyle = bgColorInput.value;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
    }
    
    // åˆå§‹åŒ–ä¹å®«æ ¼
    function initGrid() {
      gridContainer.innerHTML = '';
      for (let i = 0; i < 9; i++) {
        const gridItem = document.createElement('div');
        gridItem.className = 'grid-item';
        gridItem.dataset.index = i;
        gridItem.innerHTML = '<div class="placeholder">+</div>';
        
        // ç‚¹å‡»æ ¼å­ä¸Šä¼ å›¾ç‰‡
        gridItem.addEventListener('click', function(e) {
          if (e.target.classList.contains('delete-btn')) return;
          currentUploadIndex = i;
          uploadToGridInput.click();
        });
        
        gridContainer.appendChild(gridItem);
      }
    }
    
    // æ›´æ–°ä¹å®«æ ¼æ˜¾ç¤º
    function updateGrid() {
      const items = gridContainer.querySelectorAll('.grid-item');
      items.forEach((item, index) => {
        if (gridImages[index]) {
          item.classList.add('filled');
          item.innerHTML = `
            <img src="${gridImages[index]}" alt="Frame ${index + 1}">
            <button class="delete-btn" onclick="deleteGridImage(${index})">Ã—</button>
          `;
        } else {
          item.classList.remove('filled');
          item.innerHTML = '<div class="placeholder">+</div>';
        }
      });
      
      // æ›´æ–°ç”ŸæˆæŒ‰é’®çŠ¶æ€
      const filledCount = gridImages.filter(img => img).length;
      generateGifBtn.disabled = filledCount < 3;
      generateGifBtn.textContent = `ğŸ¬ åˆæˆ GIF åŠ¨å›¾ (${filledCount}/9)`;
    }
    
    // åˆ é™¤ä¹å®«æ ¼å›¾ç‰‡
    window.deleteGridImage = function(index) {
      gridImages[index] = null;
      updateGrid();
      showStatus(canvasStatus, `å·²åˆ é™¤ç¬¬ ${index + 1} å¼ å›¾ç‰‡`, 'info');
    };
    
    // ç»˜ç”»åŠŸèƒ½
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);
    
    // è§¦æ‘¸æ”¯æŒ
    canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
    canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
    canvas.addEventListener('touchend', stopDrawing);
    canvas.addEventListener('touchcancel', stopDrawing);
    
    function startDrawing(e) {
      isDrawing = true;
      const rect = canvas.getBoundingClientRect();
      const scaleX = canvas.width / rect.width;
      const scaleY = canvas.height / rect.height;
      lastX = (e.clientX - rect.left) * scaleX;
      lastY = (e.clientY - rect.top) * scaleY;
    }
    
    function draw(e) {
      if (!isDrawing) return;
      
      const rect = canvas.getBoundingClientRect();
      const scaleX = canvas.width / rect.width;
      const scaleY = canvas.height / rect.height;
      const x = (e.clientX - rect.left) * scaleX;
      const y = (e.clientY - rect.top) * scaleY;
      
      ctx.strokeStyle = penColorInput.value;
      ctx.lineWidth = penSizeInput.value;
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
      
      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(x, y);
      ctx.stroke();
      
      lastX = x;
      lastY = y;
    }
    
    function stopDrawing() {
      isDrawing = false;
    }
    
    function handleTouchStart(e) {
      e.preventDefault();
      isDrawing = true;
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      const scaleX = canvas.width / rect.width;
      const scaleY = canvas.height / rect.height;
      lastX = (touch.clientX - rect.left) * scaleX;
      lastY = (touch.clientY - rect.top) * scaleY;
    }
    
    function handleTouchMove(e) {
      if (!isDrawing) return;
      e.preventDefault();
      
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      const scaleX = canvas.width / rect.width;
      const scaleY = canvas.height / rect.height;
      const x = (touch.clientX - rect.left) * scaleX;
      const y = (touch.clientY - rect.top) * scaleY;
      
      ctx.strokeStyle = penColorInput.value;
      ctx.lineWidth = penSizeInput.value;
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
      
      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(x, y);
      ctx.stroke();
      
      lastX = x;
      lastY = y;
    }
    
    // èƒŒæ™¯è‰²å˜æ›´
    bgColorInput.addEventListener('change', function() {
      ctx.fillStyle = this.value;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
    });
    
    // ç”»ç¬”ç²—ç»†æ˜¾ç¤º
    penSizeInput.addEventListener('input', function() {
      penSizeValue.textContent = this.value + 'px';
    });
    
    // å¸§å»¶è¿Ÿæ˜¾ç¤º
    frameDelayInput.addEventListener('input', function() {
      frameDelayValue.textContent = this.value + 'ms';
    });
    
    // æ¸…ç©ºç”»å¸ƒ
    clearBtn.addEventListener('click', function() {
      if (confirm('ç¡®å®šè¦æ¸…ç©ºç”»å¸ƒå—ï¼Ÿ')) {
        initCanvas();
        showStatus(canvasStatus, 'ç”»å¸ƒå·²æ¸…ç©º', 'info');
      }
    });
    
    // å®Œæˆç»˜ç”»ï¼Œæ·»åŠ åˆ°ä¹å®«æ ¼
    finishBtn.addEventListener('click', function() {
      const emptyIndex = gridImages.findIndex(img => !img);
      if (emptyIndex === -1) {
        showStatus(canvasStatus, 'ä¹å®«æ ¼å·²æ»¡ï¼Œè¯·å…ˆåˆ é™¤ä¸€äº›å›¾ç‰‡', 'error');
        return;
      }
      
      const dataURL = canvas.toDataURL('image/png');
      gridImages[emptyIndex] = dataURL;
      updateGrid();
      initCanvas();
      showStatus(canvasStatus, `å·²æ·»åŠ åˆ°ç¬¬ ${emptyIndex + 1} ä¸ªæ ¼å­`, 'success');
    });
    
    // ä¸Šä¼ å›¾ç‰‡åˆ°ç”»å¸ƒ
    uploadToCanvasBtn.addEventListener('click', function() {
      uploadToCanvasInput.click();
    });
    
    uploadToCanvasInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(event) {
        const img = new Image();
        img.onload = function() {
          // æ¸…ç©ºç”»å¸ƒå¹¶ç»˜åˆ¶å›¾ç‰‡
          ctx.fillStyle = bgColorInput.value;
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          
          // å±…ä¸­ç»˜åˆ¶ï¼Œä¿æŒæ¯”ä¾‹
          const scale = Math.min(canvas.width / img.width, canvas.height / img.height);
          const x = (canvas.width - img.width * scale) / 2;
          const y = (canvas.height - img.height * scale) / 2;
          ctx.drawImage(img, x, y, img.width * scale, img.height * scale);
          
          showStatus(canvasStatus, 'å›¾ç‰‡å·²åŠ è½½åˆ°ç”»å¸ƒï¼Œå¯ä»¥ç»§ç»­ç¼–è¾‘', 'success');
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
      this.value = '';
    });
    
    // ä¸Šä¼ å›¾ç‰‡åˆ°ä¹å®«æ ¼
    uploadToGridInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(event) {
        const img = new Image();
        img.onload = function() {
          // åˆ›å»ºä¸´æ—¶ canvas è°ƒæ•´å›¾ç‰‡å¤§å°
          const tempCanvas = document.createElement('canvas');
          tempCanvas.width = 500;
          tempCanvas.height = 500;
          const tempCtx = tempCanvas.getContext('2d');
          
          // ç™½è‰²èƒŒæ™¯
          tempCtx.fillStyle = '#ffffff';
          tempCtx.fillRect(0, 0, 500, 500);
          
          // å±…ä¸­ç»˜åˆ¶
          const scale = Math.min(500 / img.width, 500 / img.height);
          const x = (500 - img.width * scale) / 2;
          const y = (500 - img.height * scale) / 2;
          tempCtx.drawImage(img, x, y, img.width * scale, img.height * scale);
          
          gridImages[currentUploadIndex] = tempCanvas.toDataURL('image/png');
          updateGrid();
          showStatus(canvasStatus, `å·²ä¸Šä¼ åˆ°ç¬¬ ${currentUploadIndex + 1} ä¸ªæ ¼å­`, 'success');
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
      this.value = '';
    });
    
    // ç”Ÿæˆ GIF
    generateGifBtn.addEventListener('click', function() {
      const validImages = gridImages.filter(img => img);
      if (validImages.length < 3) {
        showStatus(gifStatus, 'è‡³å°‘éœ€è¦ 3 å¼ å›¾ç‰‡æ‰èƒ½ç”Ÿæˆ GIF', 'error');
        return;
      }
      
      showStatus(gifStatus, 'æ­£åœ¨ç”Ÿæˆ GIFï¼Œè¯·ç¨å€™...', 'info');
      generateGifBtn.disabled = true;
      
      const delay = parseInt(frameDelayInput.value) / 1000; // gifshot ä½¿ç”¨ç§’ä¸ºå•ä½
      
      // ä½¿ç”¨ gifshot ç”Ÿæˆ GIF
      gifshot.createGIF({
        images: validImages,
        gifWidth: 500,
        gifHeight: 500,
        interval: delay,
        numFrames: validImages.length,
        frameDuration: 1,
        sampleInterval: 10,
        numWorkers: 2
      }, function(obj) {
        if (!obj.error) {
          // å°† base64 è½¬æ¢ä¸º blob å¹¶ä¸‹è½½
          const base64Data = obj.image;
          
          // è½¬æ¢ base64 ä¸º blob
          fetch(base64Data)
            .then(res => res.blob())
            .then(blob => {
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = `animation-${Date.now()}.gif`;
              document.body.appendChild(a);
              a.click();
              document.body.removeChild(a);
              URL.revokeObjectURL(url);
              
              showStatus(gifStatus, `GIF åŠ¨å›¾å·²ç”Ÿæˆå¹¶ä¸‹è½½ï¼(${validImages.length} å¸§)`, 'success');
              generateGifBtn.disabled = false;
            })
            .catch(err => {
              showStatus(gifStatus, 'GIF ä¸‹è½½å¤±è´¥ï¼š' + err.message, 'error');
              generateGifBtn.disabled = false;
            });
        } else {
          showStatus(gifStatus, 'GIF ç”Ÿæˆå¤±è´¥ï¼š' + obj.error, 'error');
          generateGifBtn.disabled = false;
        }
      });
    });
    
    // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
    function showStatus(element, message, type) {
      element.textContent = message;
      element.className = `status-message ${type}`;
      element.style.display = 'block';
      
      if (type === 'success' || type === 'info') {
        setTimeout(() => {
          element.style.display = 'none';
        }, 3000);
      }
    }
    
    // çª—å£å¤§å°å˜åŒ–æ—¶è°ƒæ•´ç”»å¸ƒ
    let resizeTimeout;
    window.addEventListener('resize', function() {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        // ä¿å­˜å½“å‰ç”»å¸ƒå†…å®¹
        const imageData = canvas.toDataURL();
        
        // é‡æ–°åˆå§‹åŒ–ç”»å¸ƒ
        initCanvas();
        
        // æ¢å¤ç”»å¸ƒå†…å®¹
        const img = new Image();
        img.onload = function() {
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        };
        img.src = imageData;
      }, 300);
    });
    
    // åˆå§‹åŒ–
    initCanvas();
    initGrid();
    updateGrid();
  </script>

  <!--
    å·¥å…·å…ƒä¿¡æ¯ï¼š
    æ ¸å¿ƒæç¤ºè¯ï¼šåŸºäºSimon Willisonå•æ–‡ä»¶å“²å­¦å¼€å‘HTMLå·¥å…·ï¼Œè¦æ±‚ï¼š1. å•ä¸ªHTMLæ–‡ä»¶ï¼Œå†…åµŒJS/CSSï¼Œæ— æ„å»ºæ­¥éª¤ï¼ŒNo Reactï¼›2. æ ¸å¿ƒåŠŸèƒ½ï¼šCanvasç»˜ç”»ã€ä¹å®«æ ¼ç®¡ç†ã€GIFåŠ¨å›¾åˆæˆï¼›3. ä¾èµ–ï¼šgifshot@0.4.5ï¼ˆCDNï¼‰ï¼›4. äº¤äº’ï¼šç”»å¸ƒç»˜ç”»ã€é¢œè‰²é€‰æ‹©ã€å›¾ç‰‡ä¸Šä¼ ã€GIFç”Ÿæˆä¸‹è½½ï¼›5. çŠ¶æ€å­˜å‚¨ï¼šå†…å­˜ä¸­ç®¡ç†å›¾ç‰‡æ•°ç»„ã€‚
    ä¾èµ–CDNï¼šhttps://cdn.jsdelivr.net/npm/gifshot@0.4.5/dist/gifshot.min.js
    æœ€åä¿®æ”¹ï¼š2025-12-22
  -->
</body>
</html>