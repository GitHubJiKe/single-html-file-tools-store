---
alwaysApply: true
---
# Cursor Rule：HTML 单文件小工具开发规范（基于 Simon Willison 编码哲学）

## 一、核心原则：单文件优先，极简无依赖

1. **文件结构强制要求**：所有工具必须整合为**单个 HTML 文件**，将 JavaScript（内嵌`<script>`标签）、CSS（内嵌`<style>`标签）与 HTML 结构完全融合，禁止拆分多文件（如单独的.js/.css 文件），确保可直接复制粘贴使用，无需额外文件管理。
2. **框架与构建步骤禁用**：严格排除需构建步骤的技术栈，核心规则为**“No React”**，同时禁止使用 Vue、Svelte 等需编译/打包的框架；仅允许使用原生 HTML/CSS/JS，或无需构建的轻量库（如纯 JS 实现的工具类库）。
3. **精简代码规模**：单个工具代码量控制在**100-500 行**（含 HTML/CSS/JS），避免冗余逻辑；优先通过原生 API 实现功能（如`fetch`替代 Axios、`localStorage`替代第三方存储库），确保 LLM 可快速理解、修改代码。

## 二、依赖管理：CDN 加载，版本锁定

1. **依赖引入规范**：仅允许通过**公共 CDN 加载必要依赖**，优先选择 cdnjs、jsdelivr 等稳定 CDN，禁止使用 npm/yarn 安装依赖（避免构建步骤）；引入时必须指定**精确版本号**（如`https://cdn.jsdelivr.net/npm/pdfjs-dist@3.4.120/build/pdf.min.js`），防止版本迭代导致工具失效。
2. **依赖筛选原则**：满足以下任一条件才允许引入依赖：
   - 原生 API 无法实现的核心功能（如 PDF 解析用 PDF.js、OCR 用 Tesseract.js）；
   - 可显著减少代码量（如日期处理用 dayjs，而非手写日期格式化逻辑）；
   - 需 WebAssembly 支持的工具（如 Pyodide、Tesseract.js）。
3. **CDN 兼容性检查**：引入依赖前，需在 Cursor 中通过“预览功能”验证 CDN 链接有效性，确保在无网络缓存时仍能正常加载（可添加简单加载失败兜底逻辑，如`<script src="xxx" onerror="alert('依赖加载失败，请检查CDN链接')"></script>`）。

## 三、功能实现：用户友好，本地优先

1. **输入输出优化**：强制支持**复制粘贴交互**，核心功能需包含：
   - 文本类工具：添加“Copy to Clipboard”按钮（使用`navigator.clipboard.writeText()`实现），支持一键复制结果；
   - 文件类工具：通过`<input type="file">`实现本地文件读取（禁止文件上传到服务器），利用`FileReader`API 处理文件内容（如 PDF/OCR/图片裁剪）；
   - 移动端适配：复制按钮尺寸不小于`44×44px`，输入框支持触控缩放，避免移动端操作卡顿。
2. **状态存储规范**：
   - 轻量状态（如配置参数、临时输入内容）：通过**URL 查询参数**存储（如`?package=llm-mistral&version=0.27`），支持书签分享、页面刷新后恢复状态；
   - 敏感/大量数据（如 API 密钥、长文本内容）：使用`localStorage`存储，存储前需添加用户确认逻辑（如“是否保存 API 密钥到本地？”），禁止存储明文密码等超高敏感信息；
   - 禁止使用 sessionStorage（会话级存储易丢失）、IndexedDB（复杂度过高），除非工具需处理 10MB 以上数据。
3. **离线可用性**：核心功能需支持**本地离线运行**，禁止依赖后端服务；若需调用 API，必须选择支持 CORS 的接口（如 PyPI API、GitHub Public API），并添加离线兜底提示（如“无网络连接，无法获取数据”）。

## 四、调试与可维护性：可视化调试，可追溯

1. **调试工具集成**：工具需内置极简调试能力，至少满足以下一项：
   - 文本类工具：添加“显示原始数据”开关，可查看 API 返回结果、剪贴板原始内容（如`console.log()`输出+页面内“调试面板”显示）；
   - 文件类工具：支持预览处理前/后的文件内容（如图片裁剪工具显示原图与裁剪预览对比、OCR 工具显示识别前图片与识别文本对照）；
   - 状态类工具：添加“导出状态”按钮，可将`localStorage`/URL 状态导出为 JSON，便于问题定位。
2. **代码可追溯性**：
   - 在 HTML 文件末尾添加“工具元信息”注释，包含：LLM 生成时的核心提示词（如“Build an SVG to PNG converter with local file processing, no React”）、依赖 CDN 链接清单、最后修改时间；
   - 若基于已有工具修改，需在注释中注明原工具名称及修改点（如“基于 simonw/svg-render 修改：新增背景色自定义功能”）。
3. **兼容性适配**：需兼容主流现代浏览器（Chrome 90+、Firefox 88+、Safari 14+），避免使用浏览器专属 API（如 Chrome 的`chrome.storage`）；必要时添加浏览器兼容性检测（如`if (!window.fetch) alert('请升级浏览器以支持本工具')`）。

## 五、Cursor 使用配套技巧

1. **Prompt 模板快捷调用**：在 Cursor 中输入`/html-tool`触发预设提示词模板，模板内容如下：
   ```
   基于Simon Willison单文件哲学开发HTML工具，要求：
   1. 单个HTML文件，内嵌JS/CSS，无构建步骤，No React；
   2. 核心功能：[此处填写工具功能，如“SVG转PNG，支持本地文件上传与下载”]；
   3. 依赖：仅使用[此处填写必要依赖，如“无依赖”或“PDF.js@3.4.120（cdnjs）”]；
   4. 交互：包含[此处填写交互元素，如“文件选择框、转换按钮、复制结果按钮”]；
   5. 状态存储：使用[此处填写存储方式，如“URL参数存储输出尺寸”或“localStorage存储历史记录”]。
   ```
2. **代码生成后校验**：生成代码后，在 Cursor 中执行以下校验步骤（可通过“任务面板”一键触发）：
   1. 检查是否存在多文件引用（搜索`<link rel="stylesheet"`/`<script src=`，确认仅 CDN 链接无本地文件）；
   2. 验证代码行数（通过 Cursor“统计行数”功能，确认总行数 ≤500 行）；
   3. 测试核心功能（如文件上传、按钮点击、数据存储），确保无控制台报错。
3. **快速迭代技巧**：修改工具时，在 Cursor 中先复制原工具代码，再添加“修改指令”（如“在现有 SVG 转 PNG 工具中，新增‘背景色选择’功能，使用原生`<input type="color">`，状态存储到 localStorage”），利用 LLM 基于原代码精准迭代，避免重写。

## 六、违规场景定义

以下情况均视为违反本规则，需在 Cursor 中触发“代码优化提示”：

1. 使用 React/Vue 等需构建的框架，或引入`node_modules`目录下的依赖；
2. 代码量超过 500 行且无合理理由（如包含大量重复 HTML 模板，未通过 JS 动态生成）；
3. 依赖 CDN 未指定版本号，或使用非公共 CDN（如企业内部私有 CDN）；
4. 核心功能需上传文件到服务器，或依赖非 CORS 接口；
5. 未添加“复制/导出”交互，或状态存储未使用 URL/localStorage。
